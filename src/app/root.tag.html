import riot from 'riot'

<app-root>
  <parts-header></parts-header>
  <parts-mockbox></parts-mockbox>
  <parts-help if={isHelpOpen}></parts-help>
  <parts-iframe-mock if={currentUrl} data-src={currentUrl}></parts-iframe-mock>
  <script>
    import { observe } from 'dob'
    import route from 'riot-route'
    import './parts/question'
    import './parts/header'
    import './parts/help'
    import './parts/iframe-mock'
    import './parts/mockbox'
    import state from '../state'
    import * as Actions from '../actions'

    this.isHelpOpen = false

    observe(() => {
      this.update({
        isHelpOpen: state.help.isOpen,
        currentUrl: state.mock.currentUrl
      })
    })

    route('*', (routerStr) => {
      try {
        const routerObj = JSON.parse(decodeURIComponent(routerStr))
        const {mockUrl} = routerObj
        Actions.setCurrentUrl(mockUrl)
      } catch (e) {
        Actions.setCurrentUrl(null)
      }
    })

    route('..', () => {
      Actions.setCurrentUrl(null)
    })

    route.start()
  </script>
</app-root>
